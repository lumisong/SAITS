# 简单插补测试实验

Simple_RNN_on_imputed_data.py

## 源代码

## 代码解析

Python 脚本 ( Simple_RNN_on_imputed_data.py )，用于在估算数据上定义和训练简单的 RNN 模型。

1. LoadImputedDataAndLabel 类：该类用于加载和转换估算数据集和相应的标签。它是 PyTorch Dataset 类的子类。
2. ImputedDataLoader 类：此类用于从 HDF5 文件加载训练、验证和测试数据集，并为每个数据集生成 PyTorch DataLoader 实例。
3. SimpleRNNClassification 类：此类定义了用于二元分类任务的简单循环神经网络 (RNN)。它使用 LSTM 层和线性层。
4. train 函数：该函数训练模型。它包括一个早期停止机制，用于监视验证集上的 ROC_AUC。
5. Main Program:主要程序：
   1. 它首先解析命令行参数。
   2. 然后，它设置日志记录和输出目录。
   3. 初始化数据加载器和模型。
   4. 如果脚本在训练模式下运行，它将使用 train 函数训练模型。
   5. 如果脚本在测试模式下运行，它将加载保存的模型并在测试集上对其进行评估。

该脚本假设执行二元分类任务，其目标是根据特征向量序列预测二元标签。输入数据应该经过预处理以处理缺失值。它使用估算数据，即缺失值已被估计值替换的数据。

填补后数据上进行时间序列分类的Pytorch实现。

主要步骤:

1. 定义ImputedDataLoader类,读取原始数据和填补后数据,创建训练集、验证集、测试集的DataLoader。
2. 定义SimpleRNNClassification类,实现基于LSTM的时间序列分类模型。
3. 在主函数中解析参数,创建日志和模型保存目录。
4. 构建模型和数据加载器。
5. 如果不是测试模式,进行模型训练:
    - 计算验证集上的指标,保存最佳模型
    - 当early stopping被触发时停止训练
6. 如果是测试模式,加载预训练模型,在测试集上计算指标。

主要特点:

- 可以在填补后数据上直接进行模型训练和评估,完成下游分类任务
- 使用LSTM提取时间序列特征,添加全连接层完成分类
- 实现了模型训练、验证、测试等基本流程
- 支持命令行参数配置,方便调试
- 可以复用在任何时序填补的数据上,进行下游分类或回归任务
整体是一个非常简洁的Pytorch时间序列分类案例,很好地利用了填补后数据,可以作为时序数据分类任务的参考模板。

## 代码debug 细节

### 1. 脚本运行，参数解析

A. 解析命令行参数：parsering command line arguments
B. 控制台命令：
  
  1. python Simple_RNN_on_imputed_data.py --help
  2. python Simple_RNN_on_imputed_data.py --data_dir=../data/ --output_dir=../output/ --mode=train --batch_size=32 --num_epochs=100 --patience=10 --lr=0.001 --weight_decay=0.0001 --hidden_size=64 --num_layers=2 --dropout=0.5 --bidirectional --num_workers=0 --seed=123
  3. 注意：--test_mode 参数，用于测试模型，命令行中含有该参数时，则直接为true。不接受参数值。